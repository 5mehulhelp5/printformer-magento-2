require(["jquery","jquery/ui","Magento_Ui/js/modal/modal","mage/translate"],function(b){b.fn.extend({printformerTools:function(c){return new a(this,c)}});var a=function(d,c){this.element=(d instanceof b)?d:b(d);this.options=c;return this.init()};a.prototype={init:function(){return this},isDefined:function(c){return typeof c!==typeof undefined},preselect:function(){return this.preselectAction.init(this,this.options)},sessionData:function(){return this.sessionDataAction.init(this,this.options)}};a.prototype.preselectAction={init:function(d,c){this.parentObject=d;this.options=c;return this},initButton:function(){var c=this;var d=c.options.saveUrl;b(this.parentObject.element).click(function(){var e=c.getAllOptions();b.ajax({url:d,method:"post",data:{product_options:JSON.stringify(e)}}).done(function(f){})});return this},getPreselectedOptions:function(){var d=this;if(typeof this.options.preselected!=typeof undefined&&typeof this.options.preselected.product_options!=typeof undefined){var c=this.options.preselected.product_options;d.preselectOptions(c);b(document).trigger("printformer_preselect_options_after")}else{b.ajax({url:this.options.optionsUrl,method:"get",dataType:"json"}).done(function(e){d.preselectOptions(e);b(document).trigger("printformer_preselect_options_after");return true})}return this},preselectOptions:function(e){var i=this;if(e!=null){if(this.parentObject.isDefined(e)){if(e.product==this.options.currentProduct){var j=false;var f=".price-model-box";if(b(f).length){j=true;var d=b(f).find(":input");b.each(d,function(n,m){if(b(m).attr("type")=="radio"){var l=b(m).val();if(i.parentObject.isDefined(e.pricemodel)){if(i.parentObject.isDefined(e.pricemodel.value)){if(l.length&&l==e.pricemodel.value){b(m).prop("checked",true)}}}}})}if(this.parentObject.isDefined(e.qty)&&this.parentObject.isDefined(e.qty.value)){var h="#qty";if(b(h).length){b(h).val(e.qty.value);b(h).trigger("change")}}var g=".product-fees";if(b(g).length){var c=b(g).children(".fee.field");b.each(c,function(o,l){var m=b(l).children(".fee-option");var n=b(m).data("fee-id");if(typeof e.product_fees!==typeof undefined&&typeof e.product_fees[n]!==typeof undefined){if(e.product_fees[n].value==true){b(m).prop("checked",true)}}})}var k=b(".product-options-wrapper :input");b.each(k,function(m,l){if(b(l).hasClass("product-custom-option")&&b(l).attr("type")=="checkbox"){var n=b(l).attr("id");if(i.parentObject.isDefined(e[n])&&e[n].value==b(l).val()){b(l).prop("checked",true)}}if(b(l).prop("tagName").toLowerCase()=="select"&&b(l).hasClass("product-custom-option")){b.each(e,function(o,p){if(b(l).data("selector")=="options["+o+"]"){b(l).val(p.value)}})}if(b(l).hasClass("product-custom-option")&&b(l).attr("type")=="radio"){b.each(e,function(o,p){if(b(l).data("selector")=="options["+o+"]"&&b(l).val()==p.value){b(l).prop("checked",true)}})}b(l).trigger("change")})}}}return this},getAllOptions:function(){var k=b(".product-options-wrapper .product-custom-option");var c={};c.product=this.options.currentProduct;var i=[];b.each(b(k),function(n,o){var m=null,p=null,l=null;if(b(o).prop("tagName").toLowerCase()=="select"){m=b(o).attr("data-selector").match(/options\[(\d+)\]/);p=m[1];l=b(o).val();if(l.length){c[p]={value:l}}}if(b(o).attr("type")=="radio"){if(b(o).prop("checked")){m=b(o).attr("data-selector").match(/options\[(\d+)\]/);p=m[1];l=b(o).val();if(l.length){c[p]={value:l}}}}if(b(o).attr("type")=="checkbox"){i.push(o)}});b.each(i,function(m,n){if(b(n).prop("checked")){var l=b(n).val();if(l.length){c[b(n).attr("id")]={value:l}}}});var j="#qty";if(b(j).length){var f=b(j).val();if(f.length){c.qty={value:f}}}var h=".product-fees";if(b(h).length){var d=b(h).children(".fee.field");b.each(d,function(o,l){var m=b(l).children(".fee-option");var n=b(m).data("fee-id");if(b(m).prop("checked")){if(!(typeof c.product_fees=="object")){c.product_fees={}}c.product_fees[n]={value:b(m).prop("checked")}}})}var g=".price-model-box";if(b(g).length){var e=b(g).find(":input");b.each(e,function(o,m){if(b(m).attr("type")=="radio"){if(b(m).prop("checked")){var n=b(m).attr("data-selector").match(/options\[(\d+)\]/);var l=b(m).val();if(l.length){c.pricemodel={value:l}}}}})}return c}};a.prototype.sessionDataAction={init:function(d,c){this.parentObject=d;this.options=c;return this},initButton:function(){var c=this;b(this.parentObject.element).click(function(){c.saveDataToSession(this)});return this},saveDataToSession:function(d){this.masterId=b(d).data("pf-masterid");this.draftType=b(d).data("pf-type");var c={master_id:this.masterId,draft_type:this.draftType};b.ajax({url:this.options.saveUrl,method:"post",data:c});return this},getSavedEditorCalls:function(c){var d=this;b(this.parentObject.element).click(function(f){f.preventDefault();b.ajax({url:c,method:"get",dataType:"json"}).done(function(h){if(h!==null){var g=b("<div/>").html("<h2>"+b.mage.__("You've made two Drafts. Please select the one you want to add to cart.")+"</h2>");var j=b("<select/>");var e=[];var i=0;b.each(h,function(o,k){var n=k.draft_id;var l=k.master_id;var m=b("<option/>").val(n).text(b.mage.__("draft-"+o));e[n]=l;b(j).append(b(m));i++});b(g).append(b(j));if(i>1){b(g).modal({autoOpen:true,responsive:true,clickableOverlay:true,type:"popup",buttons:[{text:b.mage.__("Confirm"),attr:{"data-action":"confirm"},"class":"action-primary",click:function(){var l=b("#printformer_draftid");var k=b("#printformer_masterid");if(b(l).length&&b(k).length){b(l).val(b(j).val());b(k).val(e[b(j).val()])}this.closeModal();d.deleteDraftSessionAndSubmit(c)}}]})}else{d.deleteDraftSessionAndSubmit(c)}}else{d.deleteDraftSessionAndSubmit(c)}});return false});return this},deleteDraftSessionAndSubmit:function(c){b.ajax({url:c+"?delete=true",method:"get",dataType:"json"}).done(function(){b("#product_addtocart_form").trigger("submit")})},addDraftIdToSession:function(d,e){this.masterId=b(d).data("pf-masterid");this.draftType=b(d).data("pf-type");var c={master_id:this.masterId,draft_type:this.draftType,draft_id:e};b.ajax({url:this.options.saveUrl+"?setDraftID=true",method:"post",data:c})}}});